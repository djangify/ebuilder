<!--shop/templates/shop/list.html-->
{% extends "base.html" %}
{% load static %}
{% load currency_tags %}

{% block extra_head %}
<link rel="canonical" href="{{ request.build_absolute_uri }}">

<!-- AI Search Metadata -->
<meta name="ai-page-type" content="shop-list">
<meta name="ai-topics" content="digital downloads">

<!-- Open Graph -->
{% include "includes/seo/og_meta.html" with 
    og_title=shop_settings.hero_title|default:"Shop"
    og_description=shop_settings.intro_body|default:"Browse our collection of digital products and resources"|truncatewords:30
%}

<!-- ItemList Schema -->
{% include "includes/seo/schema_itemlist.html" with 
    items=products 
    list_name="Shop Products" 
%}
{% endblock %}

{% block content %}

<!-- ============================================
     HERO SECTION (always first)
     ============================================ -->
<header class="relative overflow-hidden bg-gradient-to-br from-[color:var(--color-light)] via-white to-[color:var(--color-light)]">
  
  {# Background pattern #}
  
  
   <div class="absolute inset-0 opacity-[0.02]" style="background-image: url('data:image/svg+xml,%3Csvg width=&quot;40&quot; height=&quot;40&quot; viewBox=&quot;0 0 40 40&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot;%3E%3Cpath d=&quot;M20 20.5V18H0v-2h20v-2.5a2.5 2.5 0 015 0V16h15v2H25v2.5a2.5 2.5 0 01-5 0z&quot; fill=&quot;%23000&quot; fill-opacity=&quot;1&quot; fill-rule=&quot;evenodd&quot;/%3E%3C/svg%3E');"></div> 
  
  <div class="relative w-full max-w-6xl mx-auto px-6 md:px-10 lg:px-16 py-16 md:py-24">
    
    <div class="{% if shop_settings.hero_image %}grid md:grid-cols-2 gap-12 items-center{% endif %}">
      <!-- Text Content -->
      <div class="{% if not shop_settings.hero_image %}max-w-3xl{% endif %}">
        {% if shop_settings.hero_subtitle %}
        <p class="uppercase text-sm tracking-widest text-[color:var(--color-accent)] mb-3 font-medium">
          {{ shop_settings.hero_subtitle }}
        </p>
        {% endif %}
        
        <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold text-[color:var(--color-primary)] mb-6 leading-tight">
          {{ shop_settings.hero_title|default:"The Shop" }}
        </h1>
        
        {% if shop_settings.hero_body %}
        <div class="text-lg text-[color:var(--color-text-muted)] mb-8 {% if not shop_settings.hero_image %}max-w-2xl{% endif %}">
          {{ shop_settings.hero_body|safe }}
        </div>
        {% endif %}

        {% if shop_settings.hero_button_text and shop_settings.hero_button_link %}
        <a href="{{ shop_settings.hero_button_link }}" 
           class="inline-flex items-center px-6 py-3 bg-[color:var(--color-accent)] text-white font-semibold rounded-md hover:bg-[color:var(--color-accent)]/90 transition-colors">
          {{ shop_settings.hero_button_text }}
          <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
          </svg>
        </a>
        {% endif %}
      </div>

      <!-- Hero Image (right side) -->
      {% if shop_settings.hero_image %}
      <div>
        <img src="{{ shop_settings.hero_image.url }}" 
             alt="{{ shop_settings.hero_title }}" 
             class="w-full h-auto rounded-lg shadow-xl">
      </div>
      {% endif %}
    </div>
    
  </div>
</header>


<!-- ============================================
     DYNAMIC SECTIONS (ordered by admin settings)
     ============================================ -->
{% for section in sections %}

  {% if section.type == 'intro' %}
  <!-- INTRO SECTION -->
  <section class="py-12 md:py-16 bg-white">
    <div class="max-w-4xl mx-auto px-6 md:px-10 lg:px-16 text-center">
      {% if shop_settings.intro_title %}
      <h2 class="text-3xl md:text-4xl font-bold text-[color:var(--color-primary)] mb-6">
        {{ shop_settings.intro_title }}
      </h2>
      {% endif %}
      
      {% if shop_settings.intro_body %}
      <div class="text-lg text-[color:var(--color-text-muted)] prose prose-lg mx-auto">
        {{ shop_settings.intro_body|safe }}
      </div>
      {% endif %}
    </div>
  </section>
  {% endif %}

  {% if section.type == 'promo_blocks' %}
  <!-- PROMO BLOCKS SECTION -->
  {% for block in promo_blocks %}
  <section class="py-8 md:py-10 bg-white">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">

        {% if block.col_1_title or block.col_1_body %}
        <div class="bg-white text-center rounded-md p-8 shadow-md border border-[color:var(--color-secondary)]
                    hover:border-[color:var(--color-accent)] transition-all duration-300 hover:shadow-xl">
          {% if block.col_1_image %}
          <div class="w-14 h-14 mx-auto bg-[color:var(--color-accent)]/10 rounded-md flex items-center justify-center mb-4 overflow-hidden">
            <img src="{{ block.col_1_image.url }}" alt="{{ block.col_1_title }}" class="w-8 h-8 object-contain">
          </div>
          {% endif %}
          {% if block.col_1_title %}
          <h3 class="text-xl font-bold text-[color:var(--color-primary)] mb-3">{{ block.col_1_title }}</h3>
          {% endif %}
          {% if block.col_1_body %}
          <div class="text-[color:var(--color-text-muted)] max-w-none">{{ block.col_1_body|safe }}</div>
          {% endif %}
        </div>
        {% endif %}

        {% if block.col_2_title or block.col_2_body %}
        <div class="bg-white text-center rounded-md p-8 shadow-md border border-[color:var(--color-secondary)]
                    hover:border-[color:var(--color-accent)] transition-all duration-300 hover:shadow-xl">
          {% if block.col_2_image %}
          <div class="w-14 h-14 mx-auto bg-[color:var(--color-accent)]/10 rounded-md flex items-center justify-center mb-4 overflow-hidden">
            <img src="{{ block.col_2_image.url }}" alt="{{ block.col_2_title }}" class="w-8 h-8 object-contain">
          </div>
          {% endif %}
          {% if block.col_2_title %}
          <h3 class="text-xl font-bold text-[color:var(--color-primary)] mb-3">{{ block.col_2_title }}</h3>
          {% endif %}
          {% if block.col_2_body %}
          <div class="text-[color:var(--color-text-muted)] max-w-none">{{ block.col_2_body|safe }}</div>
          {% endif %}
        </div>
        {% endif %}

        {% if block.col_3_title or block.col_3_body %}
        <div class="bg-white text-center rounded-md p-8 shadow-md border border-[color:var(--color-secondary)]
                    hover:border-[color:var(--color-accent)] transition-all duration-300 hover:shadow-xl">
          {% if block.col_3_image %}
          <div class="w-14 h-14 mx-auto bg-[color:var(--color-accent)]/10 rounded-md flex items-center justify-center mb-4 overflow-hidden">
            <img src="{{ block.col_3_image.url }}" alt="{{ block.col_3_title }}" class="w-8 h-8 object-contain">
          </div>
          {% endif %}
          {% if block.col_3_title %}
          <h3 class="text-xl font-bold text-[color:var(--color-primary)] mb-3">{{ block.col_3_title }}</h3>
          {% endif %}
          {% if block.col_3_body %}
          <div class="text-[color:var(--color-text-muted)] max-w-none">{{ block.col_3_body|safe }}</div>
          {% endif %}
        </div>
        {% endif %}

      </div>
    </div>
  </section>
  {% endfor %}
  {% endif %}

  {% if section.type == 'spotlight' %}
  <!-- SPOTLIGHT SECTION -->
  <section class="py-12 md:py-16 bg-[color:var(--color-light)]">
    <div class="max-w-6xl mx-auto px-6 md:px-10 lg:px-16">
      <div class="grid md:grid-cols-2 gap-12 items-center">
        
        <!-- Text Column -->
        <div class="{% if shop_settings.spotlight_image_position == 'left' %}md:order-2{% endif %}">
          {% if shop_settings.spotlight_title %}
          <h2 class="text-3xl md:text-4xl font-bold text-[color:var(--color-primary)] mb-6">
            {{ shop_settings.spotlight_title }}
          </h2>
          {% endif %}
          
          {% if shop_settings.spotlight_body %}
          <div class="text-[color:var(--color-text-muted)] prose prose-lg mb-8">
            {{ shop_settings.spotlight_body|safe }}
          </div>
          {% endif %}
          
          {% if shop_settings.spotlight_button_text and shop_settings.spotlight_button_link %}
          <a href="{{ shop_settings.spotlight_button_link }}" 
             class="inline-flex items-center px-6 py-3 bg-[color:var(--color-accent)] text-white font-semibold rounded-md hover:bg-[color:var(--color-accent)]/90 transition-colors">
            {{ shop_settings.spotlight_button_text }}
            <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
            </svg>
          </a>
          {% endif %}
        </div>
        
        <!-- Image Column -->
        {% if shop_settings.spotlight_image %}
        <div class="{% if shop_settings.spotlight_image_position == 'left' %}md:order-1{% endif %}">
          <img src="{{ shop_settings.spotlight_image.url }}" 
               alt="{{ shop_settings.spotlight_title }}" 
               class="w-full h-auto rounded-lg shadow-xl">
        </div>
        {% endif %}
        
      </div>
    </div>
  </section>
  {% endif %}

{% endfor %}


<!-- ============================================
     MAIN PRODUCT LISTING (always last)
     ============================================ -->
<div id="products" class="w-full bg-[color:var(--color-light)] py-12 md:py-16">
  <div class="w-full max-w-6xl mx-auto px-6 md:px-10 lg:px-16">

    <!-- Category Filter Section -->
    <div class="mb-12">
      <!-- Mobile Filter Button -->
      <button id="filterToggle" 
              data-collapse-toggle="categories-grid"
              class="lg:hidden w-full mb-4 px-5 py-3 bg-white text-[color:var(--color-primary)] rounded-xl shadow-md flex items-center justify-between font-semibold border border-[color:var(--color-accent)]/20">
        <span class="flex items-center gap-2">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"/>
          </svg>
          Filter by Category
        </span>
        <svg class="w-5 h-5 transition-transform" id="filterIcon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
        </svg>
      </button>

      <!-- Categories Grid -->
      <div id="categories-grid" class="hidden lg:block">
        <div class="flex flex-wrap justify-center gap-3">
          <!-- All Products Tab -->
          <a href="{% url 'shop:product_list' %}" 
             class="px-5 py-2.5 rounded-full font-medium transition-all duration-300 {% if not current_category %}bg-[color:var(--color-primary)] text-white shadow-lg{% else %}bg-white text-[color:var(--color-primary)] hover:bg-[color:var(--color-primary)] hover:text-white shadow-md{% endif %}">
            All Products
          </a>
          
          <!-- Dynamic Category Tabs -->
          {% for category in categories %}
          <a href="?category={{ category.slug }}" 
             class="px-5 py-2.5 rounded-full font-medium transition-all duration-300 {% if current_category and current_category.id == category.id %}bg-[color:var(--color-primary)] text-white shadow-lg{% else %}bg-white text-[color:var(--color-primary)] hover:bg-[color:var(--color-primary)] hover:text-white shadow-md{% endif %}">
            {{ category.name }}
          </a>
          {% endfor %}
        </div>
      </div>
    </div>

    <!-- Results Count -->
    {% if products %}
    <p class="text-[color:var(--color-font-main)]/70 text-center mb-8">
      Showing {{ products|length }} product{% if products|length != 1 %}s{% endif %}
      {% if current_category %}in <span class="font-semibold text-[color:var(--color-primary)]">{{ current_category.name }}</span>{% endif %}
      {% if query %}matching "<span class="font-semibold text-[color:var(--color-primary)]">{{ query }}</span>"{% endif %}
    </p>

    <!-- Product Grid -->
    <div class="grid gap-8 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4">
      {% for product in products %}
        {% include "shop/includes/product_card.html" with product=product %}
      {% endfor %}
    </div>

    <!-- Pagination -->
    {% if products.has_other_pages %}
    <nav class="mt-12 flex justify-center" aria-label="Product pagination">
      <ul class="flex items-center gap-2">
        {% if products.has_previous %}
        <li>
          <a href="?page={{ products.previous_page_number }}{% if query %}&q={{ query }}{% endif %}{% if current_category %}&category={{ current_category.slug }}{% endif %}" 
             class="px-4 py-2 rounded-lg bg-white border border-gray-200 hover:bg-[color:var(--color-accent)]/10 transition-colors"
             aria-label="Previous page">
            &laquo; Prev
          </a>
        </li>
        {% endif %}
        
        <li class="px-4 py-2 text-[color:var(--color-text-muted)]">
          Page {{ products.number }} of {{ products.paginator.num_pages }}
        </li>
        
        {% if products.has_next %}
        <li>
          <a href="?page={{ products.next_page_number }}{% if query %}&q={{ query }}{% endif %}{% if current_category %}&category={{ current_category.slug }}{% endif %}" 
             class="px-4 py-2 rounded-lg bg-white border border-gray-200 hover:bg-[color:var(--color-accent)]/10 transition-colors"
             aria-label="Next page">
            Next &raquo;
          </a>
        </li>
        {% endif %}
      </ul>
    </nav>
    {% endif %}

    {% else %}
    <!-- Empty State -->
    <div class="text-center py-16">
      <svg class="w-16 h-16 mx-auto text-gray-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/>
      </svg>
      <h2 class="text-xl font-semibold text-[color:var(--color-primary)] mb-2">No products found</h2>
      <p class="text-[color:var(--color-text-muted)] mb-6">
        {% if query %}
        No products match your search. Try different keywords.
        {% elif current_category %}
        No products available in this category yet.
        {% else %}
        Check back soon for new additions!
        {% endif %}
      </p>
      <a href="{% url 'shop:product_list' %}" class="inline-flex items-center gap-2 px-6 py-3 bg-[color:var(--color-primary)] text-white font-semibold rounded-lg hover:bg-[color:var(--color-accent)] transition-colors">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
        </svg>
        View All Products
      </a>
    </div>
    {% endif %}

  </div>
</div>


<!-- ============================================
     TRUST SECTION
     ============================================ -->
<div class="w-full bg-white py-12">
  <div class="w-full max-w-4xl mx-auto px-6 md:px-10 lg:px-16">
    <div class="grid grid-cols-2 md:grid-cols-4 gap-8 text-center">
      <div class="flex flex-col items-center">
        <div class="w-12 h-12 rounded-full bg-emerald-100 flex items-center justify-center mb-3">
          <svg class="w-6 h-6 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
          </svg>
        </div>
        <p class="text-sm font-semibold text-[color:var(--color-primary)]">Instant Download</p>
      </div>
      <div class="flex flex-col items-center">
        <div class="w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center mb-3">
          <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
          </svg>
        </div>
        <p class="text-sm font-semibold text-[color:var(--color-primary)]">Secure Payment</p>
      </div>
      <div class="flex flex-col items-center">
        <div class="w-12 h-12 rounded-full bg-purple-100 flex items-center justify-center mb-3">
          <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
        </div>
        <p class="text-sm font-semibold text-[color:var(--color-primary)]">Lifetime Access</p>
      </div>
      <div class="flex flex-col items-center">
        <div class="w-12 h-12 rounded-full bg-amber-100 flex items-center justify-center mb-3">
          <svg class="w-6 h-6 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 5.636l-3.536 3.536m0 5.656l3.536 3.536M9.172 9.172L5.636 5.636m3.536 9.192l-3.536 3.536M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-5 0a4 4 0 11-8 0 4 4 0 018 0z"/>
          </svg>
        </div>
        <p class="text-sm font-semibold text-[color:var(--color-primary)]">Email Support</p>
      </div>
    </div>
  </div>
</div>

{% endblock %}